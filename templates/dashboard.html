<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"> 
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.ico') }}">
    <title>Anchor University - DashBoard</title>
      <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <!-- PDF Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <header class="top-bar">
        <div class="logo"><img src="{{ url_for('static', filename='logo.png') }}" alt="Laundry family"> Anchor University - Laundry Venture</div>
        <div class="contact-info">
            <p>Hours: MON - SAT 8:00 am - 6:00 pm</p>
            <p>Email:  info@aul.edu.ng</p>
            <a href="tel:+2347070679063" class="call-btn">Call (+234) 707 067 9063</a>
        </div>
    </header>
  <style>
body {
      font-family: 'Poppins', sans-serif;
      background-color: #f4f7ff;
      margin: 0;
      padding: 0;
      color: #333;
    }
    .top-bar {
    background: linear-gradient(to right, #9348c9, #3498DB);
    color: #fff;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 30px;
    font-size: 0.9rem;
}
.call-btn {
    background-color: purple;
    padding: 5px 12px;
    border-radius: 20px;
    margin: 7px;
    color: white;
    text-decoration: none;
    transition: background-color 0.3s ease;
}

.call-btn:hover {
    background-color: #892e60;
}
.logo {
    display: flex;
}

.logo img {
    width: 20px;
    margin-top: 1.5px;
    margin-right: 10px;
}

.contact-info {
    padding: 0 15px;
    display: flex;
}
a{
    color: #fff;
    text-decoration: none;
    margin-left: 15px;
    font-weight: 500;
}
.bin a{
    border: 1px solid;
    border-radius: 10px;
    box-sizing: border-box;
    font-size: 19px;
    cursor: pointer;
    margin-left: 10%;
    padding: 10px;
    transition: background-color 0.3s ease, transform 0.3s ease;
}
.primary {
    background-color: #00bfff;
    color: white;
}

.primary:hover {
    background-color: #009acd;
    transform: scale(1.05);
}
.contact-info p {
    padding: 0 25px;
    color: white;
}
    header {
      background: linear-gradient(90deg,#3498DB ,#ffff );
      padding: 20px;
      text-align: left;
      font-size: 1.2em;
      font-family: 'Poppins', sans-serif;
      color: white;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .container {
      max-width: 900px;
      margin: auto;
      padding: 30px 20px;
    }
    h2 { color: #6A0DAD; margin-bottom: 10px; }
    .step { display: none; }
    .step.active { display: block; animation: fadeIn 0.5s ease; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    .card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      padding: 20px;
      cursor: pointer;
      text-align: center;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .card:hover { transform: translateY(-5px); box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
    .card.selected { 
      background: #e5e9ff; 
      border: 2px solid #6A0DAD;
      transform: translateY(-5px);
    }
    .card img {
      width: 80px;
      height: 80px;
      object-fit: contain;
      margin-bottom: 15px;
    }
    .buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
    }
    button {
      padding: 12px 25px;
      background: #6A0DAD;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
    }
    button:hover:not(:disabled) {
      background: #5a0b9d;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    button:disabled { 
      background-color: #ccc;
      cursor: not-allowed;
      opacity: 0.7;
    }
    .step-indicator {
      text-align: center;
      margin: 20px 0;
      position: relative;
    }
    .step-indicator .steps {
      display: flex;
      justify-content: center;
      margin-bottom: 15px;
    }
    .step-indicator .step-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #ddd;
      margin: 0 8px;
      transition: all 0.3s ease;
    }
    .step-indicator .step-dot.active {
      background: #6A0DAD;
      transform: scale(1.3);
    }
    .step-indicator .step-text {
      font-weight: 600;
      color: #6A0DAD;
    }
    .customer-details-list {
      list-style: none;
      padding: 0;
      margin: 0;
      max-width: 500px;
    }
    .customer-details-list li {
      display: flex;
      flex-direction: column;
      margin-bottom: 15px;
    }
    .customer-details-list label {
      font-weight: 600;
      margin-bottom: 6px;
      color: #6A0DAD;
    }
    .customer-details-list input,
    .customer-details-list select {
      padding: 12px 15px;
      font-size: 16px;
      border: 1.5px solid #ccc;
      border-radius: 6px;
      transition: all 0.3s ease;
    }
    .customer-details-list input:focus,
    .customer-details-list select:focus {
      outline: none;
      border-color: #6A0DAD;
      box-shadow: 0 0 5px rgba(106, 13, 173, 0.3);
    }
    #pickupAddress {
      width: 450px;
    }
    .clothing-qty {
      display: flex;
      align-items: center;
      margin-top: 10px;
    }
    .clothing-qty input {
      width: 60px;
      text-align: center;
      margin: 0 10px;
      padding: 8px;
    }
    .clothing-qty button {
      width: 30px;
      height: 30px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }
    #summaryBox {
      background: #fff;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      margin-bottom: 20px;
    }
    .summary-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }
    .summary-item:last-child {
      border-bottom: none;
    }
    .summary-total {
      font-weight: bold;
      font-size: 1.2em;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 2px solid #6A0DAD;
    }
    .loading {
      display: none;
      text-align: center;
      margin: 20px 0;
    }
    .loading-spinner {
      border: 4px solid rgba(0,0,0,0.1);
      border-radius: 50%;
      border-top: 4px solid #6A0DAD;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .success-message {
      text-align: center;
      padding: 30px;
      display: none;
    }
    .success-message h2 {
      color: #2ecc71;
    }
    .success-icon {
      font-size: 60px;
      color: #2ecc71;
      margin-bottom: 20px;
    }
    .receipt {
      background: white;
      border-radius: 10px;
      padding: 30px;
      max-width: 500px;
      margin: 0 auto;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      text-align: left;
    }
    .receipt-header {
      text-align: center;
      margin-bottom: 20px;
      border-bottom: 2px dashed #6A0DAD;
      padding-bottom: 20px;
    }
    .receipt-header h2 {
      color: #6A0DAD;
      margin: 0;
    }
    .receipt-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    .receipt-total {
      font-weight: bold;
      font-size: 1.1em;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 2px dashed #6A0DAD;
    }
    .delivery-option {
      display: flex;
      gap: 20px;
      margin: 20px 0;
    }
    .delivery-option label {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }
    .delivery-option input[type="radio"] {
      width: 18px;
      height: 18px;
    }
    .error-message {
      color: #e74c3c;
      font-size: 14px;
      margin-top: 5px;
      display: none;
    }
    .alert-message {
      background-color: #f8d7da;
      color: #721c24;
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 15px;
      display: none;
    }
    .bank-transfer-info {
      background: white;
      padding: 30px;
      border-radius: 10px;
      max-width: 500px;
      margin: 20px auto;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    /* Color selection styles */
    .color-options {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .color-option {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.2s ease;
    }
    
    .color-option.selected {
      border-color: #333;
      transform: scale(1.1);
    }
    
    /* Expanded color palette */
    .color-white { background-color: #ffffff; border: 1px solid #ddd; }
    .color-black { background-color: #000000; }
    .color-red { background-color: #ff0000; }
    .color-blue { background-color: #0000ff; }
    .color-green { background-color: #008000; }
    .color-yellow { background-color: #ffff00; }
    .color-orange { background-color: #ffa500; }
    .color-purple { background-color: #800080; }
    .color-pink { background-color: #ffc0cb; }
    .color-brown { background-color: #a52a2a; }
    .color-gray { background-color: #808080; }
    .color-navy { background-color: #000080; }
    .color-maroon { background-color: #800000; }
    .color-teal { background-color: #008080; }
    .color-olive { background-color: #808000; }
    .color-lime { background-color: #00ff00; }
    .color-aqua { background-color: #00ffff; }
    .color-silver { background-color: #c0c0c0; }
    .color-gold { background-color: #ffd700; }
    .color-beige { background-color: #f5f5dc; }
    .color-indigo { background-color: #4b0082; }
    .color-violet { background-color: #ee82ee; }
    .color-khaki { background-color: #f0e68c; }
    .color-salmon { background-color: #fa8072; }
    .color-crimson { background-color: #dc143c; }
    .color-coral { background-color: #ff7f50; }
    .color-turquoise { background-color: #40e0d0; }
    .color-lavender { background-color: #e6e6fa; }
    .color-plum { background-color: #dda0dd; }
    .color-mint { background-color: #98ff98; }
    .color-peach { background-color: #ffdab9; }
    .color-ruby { background-color: #e0115f; }
    .color-emerald { background-color: #50c878; }
    .color-sapphire { background-color: #0f52ba; }
    .color-amber { background-color: #ffbf00; }
    .color-charcoal { background-color: #36454f; }
    .color-ivory { background-color: #fffff0; }
    .color-jade { background-color: #00a86b; }
    .color-magenta { background-color: #ff00ff; }
    .color-mustard { background-color: #ffdb58; }
    .color-ochre { background-color: #cc7722; }
    .color-rose { background-color: #ff007f; }
    .color-sepia { background-color: #704214; }
    .color-tan { background-color: #d2b48c; }
    .color-ultramarine { background-color: #3f00ff; }
    .color-vermilion { background-color: #e34234; }
    .color-wine { background-color: #722f37; }
    .color-zinc { background-color: #7d7d7d; }
    
    /* Item details modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }
    
    .modal-content {
      background-color: #fefefe;
      margin: 10% auto;
      padding: 20px;
      border-radius: 10px;
      max-width: 500px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }
    
    .close-modal {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    
    .close-modal:hover {
      color: black;
    }
    
    .item-details {
      margin-top: 20px;
    }
    
    .item-detail {
      display: flex;
      margin-bottom: 15px;
      align-items: center;
    }
    
    .item-detail-color {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      margin-right: 10px;
      border: 1px solid #ddd;
    }
    
    .item-detail-qty {
      margin-left: auto;
      display: flex;
      align-items: center;
    }
    
    .item-detail-qty input {
      width: 50px;
      text-align: center;
      margin: 0 10px;
    }
    
    .item-detail-qty button {
      width: 25px;
      height: 25px;
      padding: 0;
      font-size: 14px;
    }
    
    /* Print button */
    .print-btn {
      background-color: #6A0DAD;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 20px;
      display: inline-block;
    }
    .logout a {
      color: blue;
      text-decoration: none;
    }
    .logout a:hover {
      text-decoration: none;
      color: darkblue;
    }
    .logout a:active {
      background-color: #5a0b9d;
    }
    .print-btn:hover {
      background-color: #5a0b9d;
    }

    /* Phone number input */
    .phone-input-container {
      position: relative;
    }
    
    .phone-prefix {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
      color: #555;
    }
    
    .phone-input {
      padding-left: 60px !important;
    }
    @media (max-width: 800px) {
        .top-bar {
            flex-direction: column;
            align-items: center;
        }
        .top-bar .call-btn {
            width: 100%;
            text-align: center;
        }
        .top-bar .call-btn:hover {
            width: 100%;
            text-align: center;
        }
        .top-bar .contact-info {
            flex-direction: column;
            align-items: center;
        }
        .top-bar .contact-info p {
            padding: 5px 0;
        }
        .top-bar .contact-info {
            padding: 0;
        }
      }
  </style>
</head>
<body>
<header>
{% if user %}
<p>Welcome, {{ user }} | </p>
<div class="logout"><a href="{{ url_for('logout') }}">Logout</a></div>
{% else %}
{% endif %}
</header>
<div class="container">
  <div class="step-indicator">
    <div class="steps">
      <div class="step-dot active"></div>
      <div class="step-dot"></div>
      <div class="step-dot"></div>
      <div class="step-dot"></div>
      <div class="step-dot"></div>
    </div>
    <div class="step-text">Step <span id="stepNumber">1</span> of 5</div>
  </div>

  <div class="alert-message" id="alertMessage"></div>

  <!-- Step 1: Washing Type -->
  <div class="step active" id="step1">
    <h2>Choose Washing Type</h2>
    <div class="card-grid">
      <div class="card" data-value="normal-wash">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRTlvKd7Y0GDfXE2gU5hVNZHfye4qtcQXn5cQ&s" alt="Normal Wash">
        <h3>Normal Wash</h3>
        <p>Standard cleaning for everyday clothes</p>
      </div>
      <div class="card" data-value="dry-clean">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQvt0WqtjKXHaCYpmdcd7YC3vDait-Vp-vy9A&s" alt="Dry Cleaning">
        <h3>Dry Cleaning</h3>
        <p>Special care for delicate fabrics</p>
      </div>
      <div class="card" data-value="ironing-only">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRa9fq0NsglFemsAy059dW9OdwmRBZl9DbP-g&s" alt="Ironing">
        <h3>Ironing Only</h3>
        <p>Professional pressing service</p>
      </div>
    </div>
  </div>

  <!-- Step 2: Delivery Type -->
  <div class="step" id="step2">
    <h2>Select Delivery Type</h2>
    <div class="card-grid">
      <div class="card" data-value="normal">
        <img src="https://echelontrainingportal.com/express/images/p2.jpeg" alt="Normal Delivery">
        <h3>Normal Delivery</h3>
        <p>96 hours</p>
        <p class="price">Standard Pricing</p>
      </div>
      <div class="card" data-value="express">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQxapMUAK0vNdk8Fg6oikLpbpNEYS9b2TOOCA&s" alt="Express Delivery">
        <h3>Express Delivery</h3>
        <p>24-48 hours turnaround</p>
        <p class="price">+₦500 per item (+₦700 for Agbada)</p>
      </div>
    </div>
  </div>

  <!-- Step 3: Clothing Items -->
  <div class="step" id="step3">
    <h2>Select Clothing Items</h2>
    <p>Choose the quantity and color for each item. Prices vary by delivery type.</p>
    
    <div id="clothingList" class="card-grid"></div>
    
    <!-- Price Summary -->
    <div style="text-align: right; margin-top: 20px;">
      <h3 style="margin-bottom: 10px;">
        Subtotal: <span style="color: #6A0DAD; font-size: 1.3em;">₦<span id="subtotalCost">0</span></span>
      </h3>
      <h3>
        Total: <span style="color: #6A0DAD; font-size: 1.3em;">₦<span id="totalCost">0</span></span>
      </h3>
    </div>
  </div>

  <!-- Step 4: Order Summary -->
  <div class="step" id="step4">
    <h2>Order Summary</h2>
    <div id="summaryBox">
      <div class="summary-section">
        <h3 style="color: #6A0DAD; margin-bottom: 15px;">Service Details</h3>
        <div class="summary-item">
          <span>Washing Type:</span>
          <span id="summary-washing-type"></span>
        </div>
        <div class="summary-item">
          <span>Delivery Type:</span>
          <span id="summary-delivery-type"></span>
        </div>
      </div>
      
      <div class="summary-section" style="margin-top: 20px;">
        <h3 style="color: #6A0DAD; margin-bottom: 15px;">Items Selected</h3>
        <div id="summary-items"></div>
        
        <div class="summary-item">
          <span>Subtotal:</span>
          <span id="summary-subtotal">₦0</span>
        </div>
        
        <div class="summary-item" id="delivery-fee-row" style="display: none;">
          <span>Delivery Fee:</span>
          <span>₦200</span>
        </div>
        
        <div class="summary-total">
          <span>Total:</span>
          <span id="summary-total">₦0</span>
        </div>
      </div>
    </div>

    <div style="margin-top: 20px;">
      <label for="specialInstructions" style="font-weight:600; color:#6A0DAD;">Special Instructions</label>
      <textarea id="specialInstructions" rows="4" placeholder="Add any special requests or instructions here..." style="width:100%; padding:15px; border-radius:6px; border:1.5px solid #ccc; resize: vertical; margin-top: 10px;"></textarea>
    </div>
  </div>

  <!-- Step 5: Customer Details + Payment -->
  <div class="step" id="step5">
    <h2>Customer Details & Delivery Option</h2>

    <div class="delivery-option">
      <label>
        <input type="radio" name="deliveryOption" value="pickup" checked> 
        I will pick up my laundry
      </label>
      <label>
        <input type="radio" name="deliveryOption" value="delivery"> 
        Deliver to my address (+₦200)
      </label>
    </div>

    <ul class="customer-details-list">
      <li>
        <label for="fullName">Full Name *</label>
        <input type="text" id="fullName" required placeholder="John Doe" />
        <div class="error-message" id="name-error">Please enter your full name</div>
      </li>
      <li>
        <label for="email">Email Address *</label>
        <input type="email" id="email" required placeholder="john@example.com" />
        <div class="error-message" id="email-error">Please enter a valid email</div>
      </li>
      <li>
        <label for="phone">Phone Number *</label>
        <div class="phone-input-container">
          <span class="phone-prefix">+234</span>
          <input type="tel" id="phone" class="phone-input" required placeholder="8012345678" pattern="[0-9]{10}" />
        </div>
        <div class="error-message" id="phone-error">Please enter a valid 10-digit phone number (after +234)</div>
      </li>
      <li id="addressField" style="display: none;">
        <label for="address">Delivery Address *</label>
        <input type="text" id="address" placeholder="123 Main Street, Lagos" />
        <div class="error-message" id="address-error">Please enter delivery address</div>
      </li>
      <li id="pickupField">
        <label for="pickupAddress">Pickup Location *</label>
        <input type="text" id="pickupAddress" placeholder="Our main store at back of guest house" disabled value="Our main store at back of guest house (back of faculty)" />
      </li>
      <li>
        <label for="pickupTime">Pickup/Delivery Date & Time *</label>
        <input type="datetime-local" id="pickupTime" required />
        <div class="error-message" id="time-error">Please select a date and time</div>
      </li>
      <li>
        <label for="paymentMethod">Payment Method *</label>
        <select id="paymentMethod" required>
          <option value="">Select payment method</option>
          <option value="paystack">Pay with Card (Paystack)</option>
          <option value="cash">Pay on Delivery (Cash)</option>
          <option value="transfer">Bank Transfer</option>
        </select>
        <div class="error-message" id="payment-error">Please select payment method</div>
      </li>
    </ul>

    <div class="loading" id="loadingIndicator">
      <div class="loading-spinner"></div>
      <p>Processing your booking...</p>
    </div>
  </div>

  <!-- Success Message with Receipt -->
  <div class="success-message" id="successMessage">
    <div class="success-icon">✓</div>
    <h2>Booking Successful!</h2>
    <p>Thank you for your order. We'll contact you shortly to confirm details.</p>
    
    <div class="receipt" id="receiptToPrint">
      <div class="receipt-header">
        <h2>Anchor University Laundry</h2>
        <p>Anchor University, Ayobo, Lagos</p>
        <p>Tel: 07070679064</p>
      </div>

      <div class="receipt-item">
        <span>Order #:</span>
        <span id="receipt-order-number"></span>
      </div>
      <div class="receipt-item">
        <span>Date:</span>
        <span id="receipt-date"></span>
      </div>
      
      <hr style="border-top: 1px dashed #ccc; margin: 15px 0;">
      
      <div class="receipt-item">
        <span>Customer:</span>
        <span id="receipt-customer-name"></span>
      </div>
      <div class="receipt-item">
        <span>Phone:</span>
        <span id="receipt-phone"></span>
      </div>
      <div class="receipt-item">
        <span>Service Type:</span>
        <span id="receipt-service-type"></span>
      </div>
      <div class="receipt-item">
        <span>Delivery Type:</span>
        <span id="receipt-delivery-type"></span>
      </div>
      
      <hr style="border-top: 1px dashed #ccc; margin: 15px 0;">
      
      <h3 style="color: #6A0DAD; margin-bottom: 10px;">Order Details</h3>
      <div id="receipt-items"></div>
      
      <div class="receipt-item">
        <span>Subtotal:</span>
        <span id="receipt-subtotal"></span>
      </div>
      <div class="receipt-item" id="receipt-delivery-fee-row">
        <span>Delivery Fee:</span>
        <span>₦200</span>
      </div>
      
      <div class="receipt-total">
        <span>TOTAL:</span>
        <span id="receipt-total"></span>
      </div>
      
      <div id="receipt-special-instructions" style="margin-top: 15px; display: none;">
        <h3 style="color: #6A0DAD; margin-bottom: 10px;">Special Instructions</h3>
        <p id="receipt-instructions-text"></p>
      </div>
      
      <hr style="border-top: 1px dashed #ccc; margin: 15px 0;">
      
      <div class="receipt-item">
        <span>Payment Method:</span>
        <span id="receipt-payment-method"></span>
      </div>
      <div class="receipt-item">
        <span>Pickup/Delivery:</span>
        <span id="receipt-pickup-time"></span>
      </div>
      <div class="receipt-item">
        <span>Location:</span>
        <span id="receipt-location"></span>
      </div>
      
      <p style="text-align: center; margin-top: 20px; font-style: italic;">
        Thank you for your business!
      </p>
    </div>
    
    <button onclick="printReceipt()" class="print-btn" style="margin-top: 20px;">Print/Download Bill</button>
    <button onclick="window.location.reload()" style="margin-top: 20px; margin-left: 10px;">Make Another Booking</button>
  </div>

  <!-- Navigation Buttons -->
  <div class="buttons">
    <button id="prevBtn" onclick="changeStep(-1)" disabled>← Back</button>
    <button id="nextBtn" onclick="changeStep(1)">Next →</button>
  </div>
</div>

<!-- Item Details Modal -->
<div id="itemDetailsModal" class="modal">
  <div class="modal-content">
    <span class="close-modal">&times;</span>
    <h2 id="modalItemName"></h2>
    <div class="item-details" id="modalItemDetails"></div>
    <button onclick="saveItemDetails()" style="margin-top: 15px;">Save Changes</button>
  </div>
</div>

<!-- Paystack Integration -->
<script src="https://js.paystack.co/v1/inline.js"></script>

<script>
  // Initialize jsPDF
  const { jsPDF } = window.jspdf;
  
  let currentStep = 0;
  const steps = document.querySelectorAll(".step");
  const nextBtn = document.getElementById("nextBtn");
  const prevBtn = document.getElementById("prevBtn");
  const stepNumber = document.getElementById("stepNumber");
  const stepDots = document.querySelectorAll(".step-dot");
  const alertMessage = document.getElementById("alertMessage");
  const itemDetailsModal = document.getElementById("itemDetailsModal");
  const modalItemName = document.getElementById("modalItemName");
  const modalItemDetails = document.getElementById("modalItemDetails");
  const closeModal = document.querySelector(".close-modal");

  // Load saved data from localStorage if available
  let selections = JSON.parse(localStorage.getItem('laundrySelections')) || {
    washingType: null,
    deliveryType: null,
    clothes: {}, // This will store objects with items array
    customerDetails: {},
    deliveryOption: 'pickup',
    specialInstructions: ''
  };

  // Expanded color palette
  const allColors = [
    'white', 'black', 'red', 'blue', 'green', 'yellow', 'orange', 
    'purple', 'pink', 'brown', 'gray', 'navy', 'maroon', 'teal', 
    'olive', 'lime', 'aqua', 'silver', 'gold', 'beige', 'indigo', 
    'violet', 'khaki', 'salmon', 'crimson', 'coral', 'turquoise', 
    'lavender', 'plum', 'mint', 'peach', 'ruby', 'emerald', 'sapphire',
    'amber', 'charcoal', 'ivory', 'jade', 'magenta', 'mustard', 'ochre',
    'rose', 'sepia', 'tan', 'ultramarine', 'vermilion', 'wine', 'zinc'
  ];

  const clothingItems = [
    // Suits and Formal Wear
    { 
      name: "Suit", 
      key: "suit", 
      normal: 1000, 
      express: 1500, 
      image: "https://cartnear.s3.us-east-2.amazonaws.com/ng/fbe176e9fab1df3f0ec020a895c2a2f8.jpg",
      colors: ['black', 'navy', 'gray', 'brown', 'blue', 'green', 'yellow', 'white', 'red', 'indigo','violet', 'purple', 'pink','orange', 'wine', 'peach', 'siver',
              'amber', 'turquoise', 'khaki', 'magenta']
    },
    { 
      name: "Blazer", 
      key: "blazer", 
      normal: 600, 
      express: 1100, 
      image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSUKsOM3bg2Ucsr80SXmmzRmoJaLsdo7TWzyg&s",
      colors: ['black', 'navy', 'gray', 'brown', 'blue', 'maroon','green', 'yellow', 'white', 'red', 'indigo','violet', 'purple', 'pink','orange', 'wine', 'peach', 'siver',
              'amber', 'turquoise', 'khaki', 'coral', 'emerald', 'mint', 'ruby', 'crimson', 'olive', 'magenta']
    },
    { 
      name: "White Shirt", 
      key: "shirt-white", 
      normal: 500, 
      express: 1000, 
      image: "https://5.imimg.com/data5/SELLER/Default/2022/3/LV/RL/EM/99697102/white-shirt-500x500.jpg",
      colors: ['white']
    },
    { 
      name: "Colored Shirt", 
      key: "shirt-colored", 
      normal: 400, 
      express: 900, 
      image: "https://4.imimg.com/data4/YW/BY/MY-2193284/d-6024-color-copy.jpg",
      colors: ['black', 'blue', 'red', 'green', 'yellow', 'purple', 'pink', 'orange', 'navy', 'gray', 'brown', 'maroon', 'indigo','violet', 'wine', 'peach', 'siLver',
              'amber', 'turquoise', 'khaki', 'coral', 'emerald', 'mint', 'ruby', 'crimson', 'olive', 'magenta', 'wine']
    },
    { 
      name: "Complete Agbada", 
      key: "complete-agbada", 
      normal: 2000, 
      express: 2700, 
      image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQVvZwa_FN7rEbSjwtwlp-epCJfipn1IGok9Q&s",
      colors: ['white', 'black', 'red', 'blue', 'green', 'yellow', 'orange', 
    'purple', 'pink', 'brown', 'gray', 'navy', 'maroon', 'teal', 
    'olive', 'lime', 'aqua', 'silver', 'gold', 'beige', 'indigo', 
    'violet', 'khaki', 'salmon', 'crimson', 'coral', 'turquoise', 
    'lavender', 'plum', 'mint', 'peach', 'ruby', 'emerald', 'sapphire',
    'amber', 'magenta', 'wine']
    },
    { 
      name: "Single Agbada", 
      key: "single-agbada", 
      normal: 1000, 
      express: 1700, 
      image: "https://www.vmcdn.ca/f/files/alimoshotoday/images/5776.jpg;w=960",
      colors: ['white', 'black', 'red', 'blue', 'green', 'yellow', 'orange', 
    'purple', 'pink', 'brown', 'gray', 'navy', 'maroon', 'teal', 
    'olive', 'lime', 'aqua', 'silver', 'gold', 'beige', 'indigo', 
    'violet', 'khaki', 'salmon', 'crimson', 'coral', 'turquoise', 
    'lavender', 'plum', 'mint', 'peach', 'ruby', 'emerald', 'sapphire',
    'amber', 'magenta', 'wine']
    },
    { 
      name: "Buba/Sokoto (Ankara)", 
      key: "buba-ankara", 
      normal: 600, 
      express: 1100, 
      image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSM3QhrcGr75ZPdqlAFZEidtoZjPiu6sPafyw&s",
      colors: ['white', 'black', 'red', 'blue', 'green', 'yellow', 'orange', 
    'purple', 'pink', 'brown', 'gray', 'navy', 'maroon', 'teal', 
    'olive', 'lime', 'aqua', 'silver', 'gold', 'beige', 'indigo', 
    'violet', 'khaki', 'salmon', 'crimson', 'coral', 'turquoise', 
    'lavender', 'plum', 'mint', 'peach', 'ruby', 'emerald', 'sapphire',
    'amber', 'magenta', 'wine']
    },
    { 
      name: "Buba/Sokoto (Material)", 
      key: "buba-material", 
      normal: 600, 
      express: 1100, 
      image: "https://i.pinimg.com/736x/cb/6a/4b/cb6a4b3c68a62d02308cca47995cb650.jpg",
      colors: ['white', 'black', 'red', 'blue', 'green', 'yellow', 'orange', 
    'purple', 'pink', 'brown', 'gray', 'navy', 'maroon', 'teal', 
    'olive', 'lime', 'aqua', 'silver', 'gold', 'beige', 'indigo', 
    'violet', 'khaki', 'salmon', 'crimson', 'coral', 'turquoise', 
    'lavender', 'plum', 'mint', 'peach', 'ruby', 'emerald', 'sapphire',
    'amber', 'magenta', 'wine']
    },
    { 
      name: "Tie", 
      key: "tie", 
      normal: 200, 
      express: 700, 
      image: "https://t4.ftcdn.net/jpg/02/23/07/15/360_F_223071561_CzovgansrBNBWQ8y5K8b5DoaIhoL0FZ2.jpg",
      colors: ['white', 'black', 'red', 'blue', 'green', 'yellow', 'orange', 
    'purple', 'pink', 'brown', 'gray', 'navy', 'maroon', 'teal', 
    'olive', 'lime', 'aqua', 'silver', 'gold', 'beige', 'indigo', 
    'violet', 'khaki', 'salmon', 'crimson', 'coral', 'turquoise', 
    'lavender', 'plum', 'mint', 'peach', 'ruby', 'emerald', 'sapphire',
    'amber', 'charcoal', 'ivory', 'jade', 'magenta', 'mustard', 'ochre',
    'rose', 'sepia', 'tan', 'ultramarine', 'vermilion', 'wine', 'zinc']
    },
    
    // Casual Wear
    { 
      name: "Polo Shirt", 
      key: "polo", 
      normal: 400, 
      express: 900, 
      image: "https://branditprintit.com.ng/wp-content/uploads/2023/08/138730_1653239423.webp",
      colors: ['white', 'black', 'red', 'blue', 'green', 'yellow', 'orange', 
    'purple', 'pink', 'brown', 'gray', 'navy', 'maroon', 'teal', 
    'olive', 'lime', 'aqua', 'silver', 'gold', 'beige', 'indigo', 
    'violet', 'khaki', 'salmon', 'crimson', 'coral', 'turquoise', 
    'lavender', 'plum', 'mint', 'peach', 'ruby', 'emerald', 'sapphire',
    'amber', 'magenta', 'wine']
    },
    { 
      name: "Jersey", 
      key: "jersey", 
      normal: 600, 
      express: 1100, 
      image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSLKI5lD8hriB3eRKHS3UruA5lL_RLPjHEmIpdCFywl4gF-6TtfnlOANUrFCdhUSxSLDXs&usqp=CAU",
      colors: ['white', 'black', 'red', 'blue', 'green', 'yellow', 'orange', 
    'purple', 'pink', 'brown', 'gray', 'navy', 'maroon', 'teal', 
    'olive', 'lime', 'aqua', 'silver', 'gold', 'beige', 'indigo', 
    'violet', 'khaki', 'salmon', 'crimson', 'coral', 'turquoise', 
    'lavender', 'plum', 'mint', 'peach', 'ruby', 'emerald', 'sapphire',
    'amber', 'magenta', 'wine']
    },

    { 
      name: "Hoodie", 
      key: "hoodie", 
      normal: 500, 
      express: 1000, 
      image: "https://blob.apliiq.com/sitestorage/resized-products/4762355_4204_577_880.jpg?v=1",
      colors: ['white', 'black', 'red', 'blue', 'green', 'yellow', 'orange', 
    'purple', 'pink', 'brown', 'gray', 'navy', 'maroon', 'teal', 
    'olive', 'lime', 'aqua', 'silver', 'gold', 'beige', 'indigo', 
    'violet', 'khaki', 'salmon', 'crimson', 'coral', 'turquoise', 
    'lavender', 'plum', 'mint', 'peach', 'ruby', 'emerald', 'sapphire',
    'amber', 'magenta', 'wine']
    },
    { 
      name: "Jacket", 
      key: "jacket", 
      normal: 700, 
      express: 1200, 
      image: "https://m.media-amazon.com/images/I/71E7c09iTdL._AC_UY1100_.jpg",
      colors: ['white', 'black', 'red', 'blue', 'green', 'yellow', 'orange', 
    'purple', 'pink', 'brown', 'gray', 'navy', 'maroon', 'teal', 
    'olive', 'lime', 'aqua', 'silver', 'gold', 'beige', 'indigo', 
    'violet', 'khaki', 'salmon', 'crimson', 'coral', 'turquoise', 
    'lavender', 'plum', 'mint', 'peach', 'ruby', 'emerald', 'sapphire',
    'amber', 'magenta', 'wine']
    },
    { 
      name: "Skirt", 
      key: "skirt", 
      normal: 400, 
      express: 900, 
      image: "https://m.media-amazon.com/images/I/71g84+opRLL._AC_SL1500_.jpg",
      colors: ['white', 'black', 'red', 'blue', 'green', 'yellow', 'orange', 
    'purple', 'pink', 'brown', 'gray', 'navy', 'maroon', 'teal', 
    'olive', 'lime', 'aqua', 'silver', 'gold', 'beige', 'indigo', 
    'violet', 'khaki', 'salmon', 'crimson', 'coral', 'turquoise', 
    'lavender', 'plum', 'mint', 'peach', 'ruby', 'emerald', 'sapphire',
    'amber', 'magenta', 'wine']
    },
    { 
      name: "Trousers", 
      key: "trousers", 
      normal: 400, 
      express: 900, 
      image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRc_FccMxRA_VoHRPsb6cYcEsSt-iVpShY9jg&s",
      colors: ['white', 'black', 'red', 'blue', 'green', 'yellow', 'orange', 
    'purple', 'pink', 'brown', 'gray', 'navy', 'maroon', 'teal', 
    'olive', 'lime', 'aqua', 'silver', 'gold', 'beige', 'indigo', 
    'violet', 'khaki', 'salmon', 'crimson', 'coral', 'turquoise', 
    'lavender', 'plum', 'mint', 'peach', 'ruby', 'emerald', 'sapphire',
    'amber', 'magenta', 'wine']
    },
    { 
      name: "Short Knicker", 
      key: "short-knicker", 
      normal: 300, 
      express: 800, 
      image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTQ7swcSaUPMcpl4IrU3N6bYIz2mE71XrGk_Q&s",
      colors: ['white', 'black', 'red', 'blue', 'green', 'yellow', 'orange', 
    'purple', 'pink', 'brown', 'gray', 'navy', 'maroon', 'teal', 
    'olive', 'lime', 'aqua', 'silver', 'gold', 'beige', 'indigo', 
    'violet', 'khaki', 'salmon', 'crimson', 'coral', 'turquoise', 
    'lavender', 'plum', 'mint', 'peach', 'ruby', 'emerald', 'sapphire',
    'amber', 'magenta', 'wine']
    },
    
    // Professional Wear
    { 
      name: "Lab Coat", 
      key: "labcoat", 
      normal: 400, 
      express: 900, 
      image: "https://kejanicleaning.co.ke/wp-content/uploads/2023/10/Lab-Coat-White.jpg",
      colors: ['white']
    },
    { 
      name: "Nursing Gown", 
      key: "nursing-gown", 
      normal: 400, 
      express: 900, 
      image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQskRSBQGIS7AyE2u72JI7ajtPlou7R_zUdlSlWFx02Norg5DwnUWWXorH-kl8cQ22m1Mo&usqp=CAU",
      colors: ['white', 'blue', 'pink']
    },
    
    // Household Items
    { 
      name: "Bedsheet", 
      key: "bedsheet", 
      normal: 600, 
      express: 1100, 
      image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTEZrKaV0yNOv3EaUAt4K9ucOBi5w89QJigVw&s",
      colors:['white', 'black', 'red', 'blue', 'green', 'yellow', 'orange', 
    'purple', 'pink', 'brown', 'gray', 'navy', 'maroon', 'teal', 
    'olive', 'lime', 'aqua', 'silver', 'gold', 'beige', 'indigo', 
    'violet', 'khaki', 'salmon', 'crimson', 'coral', 'turquoise', 
    'lavender', 'plum', 'mint', 'peach', 'ruby', 'emerald', 'sapphire',
    'amber', 'magenta', 'wine']
    },
    { 
      name: "Pillow Case", 
      key: "pillow-case", 
      normal: 200, 
      express: 700, 
      image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRF87AvC3W0pAPWgnrCBwjm4UB_KXL6CQ6-8Q&s",
      colors: ['white', 'black', 'red', 'blue', 'green', 'yellow', 'orange', 
    'purple', 'pink', 'brown', 'gray', 'navy', 'maroon', 'teal', 
    'olive', 'lime', 'aqua', 'silver', 'gold', 'beige', 'indigo', 
    'violet', 'khaki', 'salmon', 'crimson', 'coral', 'turquoise', 
    'lavender', 'plum', 'mint', 'peach', 'ruby', 'emerald', 'sapphire',
    'amber', 'magenta', 'wine']
    },
    { 
      name: "Colored Towels", 
      key: "towel-colored", 
      normal: 500, 
      express: 1000, 
      image: "{{ url_for('static', filename='Colored.jpg') }}",
      colors: ['white', 'black', 'red', 'blue', 'green', 'yellow', 'orange', 
    'purple', 'pink', 'brown', 'gray', 'navy', 'maroon', 'teal', 
    'olive', 'lime', 'aqua', 'silver', 'gold', 'beige', 'indigo', 
    'violet', 'khaki', 'salmon', 'crimson', 'coral', 'turquoise', 
    'lavender', 'plum', 'mint', 'peach', 'ruby', 'emerald', 'sapphire',
    'amber', 'magenta', 'wine']
    },
    { 
      name: "White Towels", 
      key: "towel-white", 
      normal: 600, 
      express: 1100, 
      image: "{{ url_for('static', filename='Towel.jpg') }}",
      colors: ['white']
    },
    { 
      name: "Duvet (Medium)", 
      key: "duvet-medium", 
      normal: 1200, 
      express: 1700, 
      image: "{{ url_for('static', filename=' Medium.jpg') }}",
      colors: ['white', 'black', 'red', 'blue', 'green', 'yellow', 'orange', 
    'purple', 'pink', 'brown', 'gray', 'navy', 'maroon', 'teal', 
    'olive', 'lime', 'aqua', 'silver', 'gold', 'beige', 'indigo', 
    'violet', 'khaki', 'salmon', 'crimson', 'coral', 'turquoise', 
    'lavender', 'plum', 'mint', 'peach', 'ruby', 'emerald', 'sapphire',
    'amber', 'magenta', 'wine']
    },
    { 
      name: "Duvet (Large)", 
      key: "duvet-large", 
      normal: 1500, 
      express: 2000, 
      image: "{{ url_for('static', filename='Duvet.jpg') }}",
      colors: ['white', 'black', 'red', 'blue', 'green', 'yellow', 'orange', 
    'purple', 'pink', 'brown', 'gray', 'navy', 'maroon', 'teal', 
    'olive', 'lime', 'aqua', 'silver', 'gold', 'beige', 'indigo', 
    'violet', 'khaki', 'salmon', 'crimson', 'coral', 'turquoise', 
    'lavender', 'plum', 'mint', 'peach', 'ruby', 'emerald', 'sapphire',
    'amber', 'magenta', 'wine']
    },
    { 
      name: "Gown", 
      key: "gown", 
      normal: 500, 
      express: 1000, 
      image: "{{ url_for('static', filename='Gown.jpg') }}",
      colors:['white', 'black', 'red', 'blue', 'green', 'yellow', 'orange', 
    'purple', 'pink', 'brown', 'gray', 'navy', 'maroon', 'teal', 
    'olive', 'lime', 'aqua', 'silver', 'gold', 'beige', 'indigo', 
    'violet', 'khaki', 'salmon', 'crimson', 'coral', 'turquoise', 
    'lavender', 'plum', 'mint', 'peach', 'ruby', 'emerald', 'sapphire',
    'amber', 'magenta', 'wine']
    },
    
    // Footwear
    { 
      name: "Sneakers", 
      key: "sneakers", 
      normal: 1500, 
      express: 2000, 
      image: "{{ url_for('static', filename='canvas.jpg') }}",
      colors: ['white', 'black', 'blue', 'red', 'green', 'gray', 'yellow', 'orange', 'pink', 'peach']
    }
  ];

  // Current item being edited in modal
  let currentItemKey = null;

  function updateDeliveryFields() {
    const isDelivery = selections.deliveryOption === 'delivery';
    document.getElementById("addressField").style.display = isDelivery ? "block" : "none";
    document.getElementById("pickupField").style.display = isDelivery ? "none" : "block";
    document.getElementById("address").required = isDelivery;
    updateTotalCost();
  }

  // Initialize the app
  document.addEventListener('DOMContentLoaded', function() {
    showStep(currentStep);
    restoreSelections();
    
    // Setup delivery option toggle
    document.querySelectorAll('input[name="deliveryOption"]').forEach(radio => {
      radio.addEventListener('change', function() {
        selections.deliveryOption = this.value;
        updateDeliveryFields();
        updateTotalCost();
        saveToLocalStorage();
      });
    });
    
    // Initialize delivery fields
    updateDeliveryFields();
    
    // Add click handlers for step 1 cards
    document.querySelectorAll("#step1 .card").forEach(card => {
      card.addEventListener("click", function() {
        document.querySelectorAll("#step1 .card").forEach(c => c.classList.remove("selected"));
        this.classList.add("selected");
        selections.washingType = this.getAttribute("data-value");
        nextBtn.disabled = false;
        saveToLocalStorage();
      });
    });
    
    // Add click handlers for step 2 cards
    document.querySelectorAll("#step2 .card").forEach(card => {
      card.addEventListener("click", function() {
        document.querySelectorAll("#step2 .card").forEach(c => c.classList.remove("selected"));
        this.classList.add("selected");
        selections.deliveryType = this.getAttribute("data-value");
        nextBtn.disabled = false;
        saveToLocalStorage();
      });
    });
    
    // Modal close button
    closeModal.addEventListener('click', function() {
      itemDetailsModal.style.display = 'none';
    });
    
    // Close modal when clicking outside
    window.addEventListener('click', function(event) {
      if (event.target === itemDetailsModal) {
        itemDetailsModal.style.display = 'none';
      }
    });

    // Format phone number input
    document.getElementById('phone').addEventListener('input', function(e) {
      // Remove any non-digit characters
      this.value = this.value.replace(/\D/g, '');
    });
  });

  function showStep(step) {
    steps.forEach((s, i) => {
      s.classList.toggle("active", i === step);
    });
    stepNumber.innerText = step + 1;
    
    // Update step indicator dots
    stepDots.forEach((dot, i) => {
      dot.classList.toggle("active", i === step);
    });
    
    prevBtn.disabled = step === 0;
    
    // Special handling for last step
    if (step === 4) {
      nextBtn.textContent = "✅ Confirm & Submit";
    } else {
      nextBtn.textContent = "Next →";
    }
    
    nextBtn.disabled = !checkSelection(step);
  }

  function checkSelection(step) {
    switch(step) {
      case 0: 
        return selections.washingType !== null;
      case 1: 
        return selections.deliveryType !== null;
      case 2: 
        return Object.values(selections.clothes).some(item => item.items && item.items.length > 0);
      default: 
        return true;
    }
  }

  function changeStep(n) {
    // Validate selection before proceeding forward
    if (n === 1 && !checkSelection(currentStep)) {
      showAlert("Please make a selection before proceeding");
      return;
    }

    // Save data before moving away from current step
    if (currentStep === 0) saveWashingType();
    if (currentStep === 1) saveDeliveryType();
    if (currentStep === 2) saveClothingItems();
    if (currentStep === 3) saveSpecialInstructions();

    // Special handling for last step (Step 4)
    if (currentStep === 4 && n === 1) {
      if (validateCustomerDetails()) {
        processPayment();
        return; // Stop further execution since processPayment() will handle the flow
      } else {
        return; // Stay on current step if validation fails
      }
    }

    // Normal step navigation for non-final steps
    currentStep += n;
  
    // Prevent going beyond step 4 (index 4 is step 5)
    if (currentStep > 4) currentStep = 4;
    // Prevent going below step 0
    if (currentStep < 0) currentStep = 0;
  
    // Load specific step content
    if (currentStep === 2) loadClothes();
    if (currentStep === 3) loadSummary();
    if (currentStep === 4) loadCustomerDetails();
  
    // Update UI to show current step
    showStep(currentStep);
  }
  
  function showAlert(message) {
    alertMessage.textContent = message;
    alertMessage.style.display = "block";
    setTimeout(() => {
      alertMessage.style.display = "none";
    }, 3000);
  }

  function saveWashingType() {
    const selected = document.querySelector('#step1 .card.selected');
    if (selected) {
      selections.washingType = selected.getAttribute("data-value");
      saveToLocalStorage();
    }
  }

  function saveDeliveryType() {
    const selected = document.querySelector('#step2 .card.selected');
    if (selected) {
      selections.deliveryType = selected.getAttribute("data-value");
      saveToLocalStorage();
    }
  }

  function saveClothingItems() {
    // Items are saved through the modal now
    saveToLocalStorage();
  }

  function saveSpecialInstructions() {
    selections.specialInstructions = document.getElementById("specialInstructions").value;
    saveToLocalStorage();
  }

  function loadCustomerDetails() {
    if (selections.customerDetails) {
      document.getElementById("fullName").value = selections.customerDetails.fullName || '';
      document.getElementById("email").value = selections.customerDetails.email || '';
      document.getElementById("phone").value = selections.customerDetails.phone || '';
      document.getElementById("address").value = selections.customerDetails.address || '';
      document.getElementById("pickupTime").value = selections.customerDetails.pickupTime || '';
      document.getElementById("paymentMethod").value = selections.customerDetails.paymentMethod || '';
    }
    
    // Set delivery option
    document.querySelector(`input[name="deliveryOption"][value="${selections.deliveryOption || 'pickup'}"]`).checked = true;
  }

  function saveToLocalStorage() {
    localStorage.setItem('laundrySelections', JSON.stringify(selections));
  }

  function restoreSelections() {
    // Restore washing type selection
    if (selections.washingType) {
      document.querySelector(`#step1 .card[data-value="${selections.washingType}"]`).classList.add("selected");
    }
    
    // Restore delivery type selection
    if (selections.deliveryType) {
      document.querySelector(`#step2 .card[data-value="${selections.deliveryType}"]`).classList.add("selected");
    }
    
    // Restore special instructions
    if (selections.specialInstructions) {
      document.getElementById("specialInstructions").value = selections.specialInstructions;
    }
  }

  function loadClothes() {
    const grid = document.getElementById("clothingList");
    grid.innerHTML = "";
    
    clothingItems.forEach(item => {
      const card = document.createElement("div");
      card.className = "card";
      
      // Generate color options HTML (just a preview)
      const previewColors = item.colors.slice(0, 3);
      const moreColors = item.colors.length > 3 ? `+${item.colors.length - 3} more` : '';
      
      const colorOptionsHTML = item.colors ? `
        <div class="color-options">
          ${previewColors.map(color => `
            <div class="color-option color-${color}" 
                 data-color="${color}" 
                 title="${color.charAt(0).toUpperCase() + color.slice(1)}"></div>
          `).join('')}
          ${moreColors ? `<span style="font-size:12px;">${moreColors}</span>` : ''}
        </div>
      ` : '';
      
      const totalQty = selections.clothes[item.key]?.items?.reduce((sum, item) => sum + item.qty, 0) || 0;
      
      card.innerHTML = `
        <img src="${item.image}" alt="${item.name}" onerror="this.src='https://via.placeholder.com/80?text=${item.name.replace(' ', '+')}'">
        <h4>${item.name}</h4>
        <p>₦${getPrice(item)} per item</p>
        ${colorOptionsHTML}
        <div class="clothing-qty">
          <button onclick="adjustQuantity('${item.key}', -1)">-</button>
          <input type="number" min="0" value="${totalQty}" data-key="${item.key}" readonly />
          <button onclick="adjustQuantity('${item.key}', 1)">+</button>
        </div>
        <button onclick="openItemDetails('${item.key}')" style="margin-top:10px; font-size:12px; padding:5px 10px;">
          Manage Items
        </button>
      `;
      grid.appendChild(card);
    });
    
    updateTotalCost();
  }

  function openItemDetails(itemKey) {
    currentItemKey = itemKey;
    const item = clothingItems.find(i => i.key === itemKey);
    modalItemName.textContent = item.name;
    modalItemDetails.innerHTML = '';
    
    // Add existing items
    if (selections.clothes[itemKey]?.items) {
      selections.clothes[itemKey].items.forEach((itemDetail, index) => {
        addItemDetailToModal(itemKey, itemDetail.color, itemDetail.qty, index);
      });
    }
    
    // Add button to add new color
    const addButton = document.createElement('button');
    addButton.textContent = 'Add Another Color';
    addButton.onclick = function() {
      addItemDetailToModal(itemKey);
    };
    addButton.style.marginTop = '15px';
    
    modalItemDetails.appendChild(addButton);
    itemDetailsModal.style.display = 'block';
  }
  function addCustomColor() {
    const customColor = document.getElementById('customColorInput').value.trim();
    if (customColor) {
      const itemKey = currentItemKey;
      addItemDetailToModal(itemKey, customColor, 1);
      document.getElementById('customColorInput').value = '';
    }
  }

  function addItemDetailToModal(itemKey, color = '', qty = 1, index = -1) {
    const itemDetailDiv = document.createElement('div');
    itemDetailDiv.className = 'item-detail';
    
    const colorSelect = document.createElement('select');
    colorSelect.className = 'item-detail-color-select';
    
    // Add color options
    const item = clothingItems.find(i => i.key === itemKey);
    item.colors.forEach(c => {
      const option = document.createElement('option');
      option.value = c;
      option.textContent = c.charAt(0).toUpperCase() + c.slice(1);
      option.style.backgroundColor = getColorValue(c);
      option.selected = c === color;
      colorSelect.appendChild(option);
    });
    
    const colorPreview = document.createElement('div');
    colorPreview.className = 'item-detail-color';
    colorPreview.style.backgroundColor = getColorValue(color || item.colors[0]);
    
    // Update color preview when selection changes
    colorSelect.addEventListener('change', function() {
      colorPreview.style.backgroundColor = getColorValue(this.value);
    });
    
    const qtyDiv = document.createElement('div');
    qtyDiv.className = 'item-detail-qty';
    
    const minusBtn = document.createElement('button');
    minusBtn.textContent = '-';
    minusBtn.onclick = function() {
      const input = qtyDiv.querySelector('input');
      const newValue = parseInt(input.value) - 1;
      input.value = newValue >= 0 ? newValue : 0;
    };
    
    const plusBtn = document.createElement('button');
    plusBtn.textContent = '+';
    plusBtn.onclick = function() {
      const input = qtyDiv.querySelector('input');
      input.value = parseInt(input.value) + 1;
    };
    
    const qtyInput = document.createElement('input');
    qtyInput.type = 'number';
    qtyInput.min = '0';
    qtyInput.value = qty;
    
    qtyDiv.appendChild(minusBtn);
    qtyDiv.appendChild(qtyInput);
    qtyDiv.appendChild(plusBtn);
    
    const removeBtn = document.createElement('button');
    removeBtn.textContent = '×';
    removeBtn.style.marginLeft = '10px';
    removeBtn.style.color = 'red';
    removeBtn.onclick = function() {
      itemDetailDiv.remove();
    };
    
    itemDetailDiv.appendChild(colorPreview);
    itemDetailDiv.appendChild(colorSelect);
    itemDetailDiv.appendChild(qtyDiv);
    itemDetailDiv.appendChild(removeBtn);
    
    // Add data-index if editing existing item
    if (index >= 0) {
      itemDetailDiv.setAttribute('data-index', index);
    }
    
    modalItemDetails.insertBefore(itemDetailDiv, modalItemDetails.lastChild);
  }

  function getColorValue(color) {
    // This is a simplified version - in a real app you might want a complete mapping
    if (color === 'white') return '#ffffff';
    if (color === 'black') return '#000000';
    if (color === 'red') return '#ff0000';
    if (color === 'blue') return '#0000ff';
    if (color === 'green') return '#008000';
    if (color === 'yellow') return '#ffff00';
    if (color === 'orange') return '#ffa500';
    if (color === 'purple') return '#800080';
    if (color === 'pink') return '#ffc0cb';
    if (color === 'brown') return '#a52a2a';
    if (color === 'gray') return '#808080';
    if (color === 'navy') return '#000080';
    if (color === 'maroon') return '#800000';
    if (color === 'teal') return '#008080';
    if (color === 'olive') return '#808000';
    if (color === 'lime') return '#00ff00';
    if (color === 'aqua') return '#00ffff';
    if (color === 'silver') return '#c0c0c0';
    if (color === 'gold') return '#ffd700';
    if (color === 'beige') return '#f5f5dc';
    if (color === 'indigo') return '#4b0082';
    if (color === 'violet') return '#ee82ee';
    if (color === 'khaki') return '#f0e68c';
    if (color === 'salmon') return '#fa8072';
    if (color === 'crimson') return '#dc143c';
    if (color === 'coral') return '#ff7f50';
    if (color === 'turquoise') return '#40e0d0';
    if (color === 'lavender') return '#e6e6fa';
    if (color === 'plum') return '#dda0dd';
    if (color === 'mint') return '#98ff98';
    if (color === 'peach') return '#ffdab9';
    if (color === 'ruby') return '#e0115f';
    if (color === 'emerald') return '#50c878';
    if (color === 'sapphire') return '#0f52ba';
    if (color === 'amber') return '#ffbf00';
    if (color === 'charcoal') return '#36454f';
    if (color === 'ivory') return '#fffff0';
    if (color === 'jade') return '#00a86b';
    if (color === 'magenta') return '#ff00ff';
    if (color === 'mustard') return '#ffdb58';
    if (color === 'ochre') return '#cc7722';
    if (color === 'rose') return '#ff007f';
    if (color === 'sepia') return '#704214';
    if (color === 'tan') return '#d2b48c';
    if (color === 'ultramarine') return '#3f00ff';
    if (color === 'vermilion') return '#e34234';
    if (color === 'wine') return '#722f37';
    if (color === 'zinc') return '#7d7d7d';
    return '#ffffff';
  }

  function saveItemDetails() {
    const itemDetails = [];
    const itemDetailsElements = modalItemDetails.querySelectorAll('.item-detail:not(button)');
    
    itemDetailsElements.forEach(detail => {
      const colorSelect = detail.querySelector('select');
      const qtyInput = detail.querySelector('input[type="number"]');
      
      if (colorSelect && qtyInput && parseInt(qtyInput.value) > 0) {
        itemDetails.push({
          color: colorSelect.value,
          qty: parseInt(qtyInput.value)
        });
      }
    });
    
    // Save to selections
    if (itemDetails.length > 0) {
      selections.clothes[currentItemKey] = {
        items: itemDetails
      };
    } else {
      delete selections.clothes[currentItemKey];
    }
    
    saveToLocalStorage();
    loadClothes(); // Refresh the display
    itemDetailsModal.style.display = 'none';
  }

  function adjustQuantity(itemKey, change) {
    if (!selections.clothes[itemKey]?.items || selections.clothes[itemKey].items.length === 0) {
      // If no items exist, create one with default color
      const item = clothingItems.find(i => i.key === itemKey);
      const defaultColor = item.colors?.[0] || '';
      
      selections.clothes[itemKey] = {
        items: [{
          color: defaultColor,
          qty: 1
        }]
      };
    } else {
      // Adjust the quantity of the first item
      const newQty = selections.clothes[itemKey].items[0].qty + change;
      if (newQty >= 0) {
        selections.clothes[itemKey].items[0].qty = newQty;
      }
      
      // Remove item if quantity is 0
      if (newQty === 0) {
        delete selections.clothes[itemKey];
      }
    }
    
    saveToLocalStorage();
    loadClothes(); // Refresh the display
  }

  function getPrice(item) {
    // Special pricing for ironing service
    if (selections.washingType === "ironing-only") {
      if (selections.deliveryType === "express") {
        return Math.ceil((item.normal + 500) * 0.5); // Half of express price
      }
      return Math.ceil(item.normal * 0.5); // Half of normal price
    }
    
    // Regular pricing for other services
    if (selections.deliveryType === "express") {
      // Special pricing for Agbada in express
      if (item.key.includes("agbada")) {
        return item.normal + 700;
      }
      return item.normal + 500;
    }
    return item.normal;
  }

  function updateTotalCost() {
    let subtotal = 0;
    clothingItems.forEach(item => {
      const itemDetails = selections.clothes[item.key]?.items || [];
      itemDetails.forEach(detail => {
        subtotal += detail.qty * getPrice(item);
      });
    });
    
    const deliveryFee = selections.deliveryOption === 'delivery' ? 200 : 0;
    const total = subtotal + deliveryFee;
    
    document.getElementById("subtotalCost").innerText = subtotal.toLocaleString();
    document.getElementById("totalCost").innerText = total.toLocaleString();
    nextBtn.disabled = subtotal === 0;
  }

  function loadSummary() {
    document.getElementById("summary-washing-type").textContent = formatWashingType(selections.washingType);
    document.getElementById("summary-delivery-type").textContent = formatDeliveryType(selections.deliveryType);
    
    const itemsContainer = document.getElementById("summary-items");
    itemsContainer.innerHTML = "";
    
    let subtotal = 0;
    
    clothingItems.forEach(item => {
      const itemDetails = selections.clothes[item.key]?.items || [];
      if (itemDetails.length > 0) {
        const price = getPrice(item);
        
        itemDetails.forEach(detail => {
          const subtotalItem = detail.qty * price;
          subtotal += subtotalItem;
          
          const itemElement = document.createElement("div");
          itemElement.className = "summary-item";
          itemElement.innerHTML = `
            <span>${item.name} (${detail.color}) (${detail.qty} × ₦${price.toLocaleString()})</span>
            <span>₦${subtotalItem.toLocaleString()}</span>
          `;
          itemsContainer.appendChild(itemElement);
        });
      }
    });
    
    const deliveryFee = selections.deliveryOption === 'delivery' ? 200 : 0;
    const total = subtotal + deliveryFee;
    
    document.getElementById("summary-subtotal").textContent = `₦${subtotal.toLocaleString()}`;
    document.getElementById("summary-total").textContent = `₦${total.toLocaleString()}`;
    
    // Show/hide delivery fee row
    const deliveryFeeRow = document.getElementById("delivery-fee-row");
    deliveryFeeRow.style.display = selections.deliveryOption === 'delivery' ? 'flex' : 'none';
  }

  function formatWashingType(type) {
    if (!type) return "Not selected";
    return type.split('-').map(word => 
      word.charAt(0).toUpperCase() + word.slice(1)
    ).join(' ');
  }

  function formatDeliveryType(type) {
    if (!type) return "Not selected";
    if (type === "normal") return "Normal (96 hours)";
    if (type === "express") return "Express (24-48 hours)";
    return type;
  }

  function validateCustomerDetails() {
    let isValid = true;
    
    // Reset error messages
    document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');
    
    // Validate name
    const name = document.getElementById("fullName").value.trim();
    if (!name) {
      document.getElementById("name-error").style.display = 'block';
      isValid = false;
    }
    
    // Validate email
    const email = document.getElementById("email").value.trim();
    if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
      document.getElementById("email-error").style.display = 'block';
      isValid = false;
    }
    
    // Validate phone
    const phone = document.getElementById("phone").value.trim();
    if (!phone || !/^\d{10}$/.test(phone)) {
      document.getElementById("phone-error").style.display = 'block';
      isValid = false;
    }
    
    // Validate pickup time
    const pickupTime = document.getElementById("pickupTime").value;
    if (!pickupTime) {
      document.getElementById("time-error").style.display = 'block';
      isValid = false;
    }
    
    // Validate payment method
    const paymentMethod = document.getElementById("paymentMethod").value;
    if (!paymentMethod) {
      document.getElementById("payment-error").style.display = 'block';
      isValid = false;
    }
    
    // Validate address if delivery
    let address = '';
    if (selections.deliveryOption === 'delivery') {
      address = document.getElementById("address").value.trim();
      if (!address) {
        document.getElementById("address-error").style.display = 'block';
        isValid = false;
      }
    } else {
      address = "Store pickup";
    }
    
    if (isValid) {
      // Save customer details
      selections.customerDetails = {
        fullName: name,
        email: email,
        phone: phone,
        address: address,
        pickupTime: pickupTime,
        paymentMethod: paymentMethod
      };
      
      saveToLocalStorage();
    }
    
    return isValid;
  }

  function processPayment() {
    const paymentMethod = document.getElementById("paymentMethod").value;
    const totalAmount = calculateTotal();
    
    if (paymentMethod === 'paystack') {
      initializePaystack(totalAmount);
    } else if (paymentMethod === 'transfer') {
      showBankTransferDetails(totalAmount);
    } else {
      // Cash on delivery
      selections.paymentReference = 'CASH-' + Math.floor(Math.random() * 1000000);
      submitBooking();
    }
  }

  function initializePaystack(totalAmount) {
    const email = document.getElementById("email").value.trim();
    const phone = '+234' + document.getElementById("phone").value.trim();
    
    // Using Paystack test key for demonstration
    const paystackPublicKey = 'pk_test_51af0a939d28e6aecf3b3e9e5d1b1b1b1b1b1b1b1b1b1b1b1b1b1b1b1b1b1b1b';
    
    const handler = PaystackPop.setup({
      key: paystackPublicKey,
      email: email,
      amount: totalAmount * 100, // Paystack expects amount in kobo
      currency: 'NGN',
      ref: 'LAU-' + Math.floor(Math.random() * 1000000),
      metadata: {
        custom_fields: [
          {
            display_name: "Phone Number",
            variable_name: "phone",
            value: phone
          }
        ]
      },
      callback: function(response) {
        // Payment was successful
        selections.paymentReference = response.reference;
        submitBooking();
      },
      onClose: function() {
        // User closed payment modal
        showAlert('Payment window closed. You can try again or choose another payment method.');
      }
    });
    handler.openIframe();
  }

  function showBankTransferDetails(totalAmount) {
    // Hide all steps and success message
    steps.forEach(step => step.style.display = "none");
    document.getElementById("successMessage").style.display = "none";
      
    // Create bank transfer info display
    const transferInfo = `
      <div class="bank-transfer-info">
        <h2>Bank Transfer Instructions</h2>
        <p>Please transfer <strong>₦${totalAmount.toLocaleString()}</strong> to:</p>
        <div class="receipt">
          <div class="receipt-item">
            <span>Bank Name:</span>
            <span>Zenith Bank Plc.</span>
          </div>
          <div class="receipt-item">
            <span>Account Number:</span>
            <span>1311796880</span>
          </div>
          <div class="receipt-item">
            <span>Account Name:</span>
            <span>Anchor University Laundry Venture</span>
          </div>
        </div>
        <p>After payment, click the button below to confirm.</p>
        <button onclick="verifyBankTransfer()" style="margin-top: 20px;">
          I've Made the Transfer
        </button>
        <button onclick="window.location.reload()" style="margin-top: 20px; margin-left: 10px;">
          Cancel
        </button>
      </div>
    `;
    
    // Clear any existing transfer info and insert new one
    const existingTransferInfo = document.querySelector('.bank-transfer-info');
    if (existingTransferInfo) {
      existingTransferInfo.remove();
    }
    document.querySelector(".container").insertAdjacentHTML('beforeend', transferInfo);
  }

  async function verifyBankTransfer() {
    document.getElementById("loadingIndicator").style.display = "block";
    
    try {
      // In a real app, you would verify payment with your backend
      // This is just a simulation
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      // Generate a random reference number
      selections.paymentReference = 'BANK-' + Math.floor(Math.random() * 1000000);
      
      // Remove the transfer info display
      const transferInfo = document.querySelector('.bank-transfer-info');
      if (transferInfo) {
        transferInfo.remove();
      }
      
      submitBooking();
    } catch (error) {
      showAlert("Payment verification failed. Please try again.");
      document.getElementById("loadingIndicator").style.display = "none";
    }
  }

  function submitBooking() {
    // Show loading indicator
    document.getElementById("loadingIndicator").style.display = "block";
    
    // Calculate totals
    let subtotal = 0;
    clothingItems.forEach(item => {
      const itemDetails = selections.clothes[item.key]?.items || [];
      itemDetails.forEach(detail => {
        subtotal += detail.qty * getPrice(item);
      });
    });
    const deliveryFee = selections.deliveryOption === 'delivery' ? 200 : 0;
    const total = subtotal + deliveryFee;
    
    // Generate receipt
    generateReceipt(subtotal, deliveryFee, total);
    
    // In a real app, you would send this data to your backend
fetch('/submit-booking', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    ...selections,
    subtotal,
    deliveryFee,
    total,
    status: 'pending',
    createdAt: new Date().toISOString()
  })
})
.then(res => res.json())
.then(data => {
  console.log('Booking saved:', data);
})
.catch(err => {
  console.error('Error saving booking:', err);
});

    // Simulate API call delay
    setTimeout(() => {
      // Hide all steps and show success message
      steps.forEach(step => step.style.display = "none");
      document.getElementById("loadingIndicator").style.display = "none";
      document.getElementById("successMessage").style.display = "block";
      document.querySelector(".buttons").style.display = "none";
      
      // Clear localStorage after successful submission
      localStorage.removeItem('laundrySelections');
    }, 2000);
  }

  function calculateTotal() {
    let subtotal = 0;
    clothingItems.forEach(item => {
      const itemDetails = selections.clothes[item.key]?.items || [];
      itemDetails.forEach(detail => {
        subtotal += detail.qty * getPrice(item);
      });
    });
    const deliveryFee = selections.deliveryOption === 'delivery' ? 200 : 0;
    return subtotal + deliveryFee;
  }

  function generateReceipt(subtotal, deliveryFee, total) {
    // Generate order number and format date
    const orderNumber = 'ORD-' + Math.floor(Math.random() * 1000000);
    const now = new Date();
    const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
    const formattedDate = now.toLocaleDateString('en-US', options);
    
    // Set receipt header info
    document.getElementById("receipt-order-number").textContent = orderNumber;
    document.getElementById("receipt-date").textContent = formattedDate;
    
    // Set customer info
    document.getElementById("receipt-customer-name").textContent = selections.customerDetails.fullName;
    document.getElementById("receipt-phone").textContent = '+234' + selections.customerDetails.phone;
    document.getElementById("receipt-service-type").textContent = formatWashingType(selections.washingType);
    document.getElementById("receipt-delivery-type").textContent = formatDeliveryType(selections.deliveryType);
    document.getElementById("receipt-payment-method").textContent = formatPaymentMethod(selections.customerDetails.paymentMethod);
    
    // Set items
    const receiptItems = document.getElementById("receipt-items");
    receiptItems.innerHTML = "";
    
    clothingItems.forEach(item => {
      const itemDetails = selections.clothes[item.key]?.items || [];
      if (itemDetails.length > 0) {
        const price = getPrice(item);
        
        itemDetails.forEach(detail => {
          const subtotalItem = detail.qty * price;
          
          const itemElement = document.createElement("div");
          itemElement.className = "receipt-item";
          itemElement.innerHTML = `
            <span>${item.name} (${detail.color}) (${detail.qty} × ₦${price})</span>
            <span>₦${subtotalItem}</span>
          `;
          receiptItems.appendChild(itemElement);
        });
      }
    });
    
    // Set totals
    document.getElementById("receipt-subtotal").textContent = `₦${subtotal}`;
    document.getElementById("receipt-total").textContent = `₦${total}`;
    
    // Show/hide delivery fee
    const deliveryFeeRow = document.getElementById("receipt-delivery-fee-row");
    deliveryFeeRow.style.display = selections.deliveryOption === 'delivery' ? 'flex' : 'none';
    
    // Set special instructions if they exist
    const instructionsContainer = document.getElementById("receipt-special-instructions");
    const instructionsText = document.getElementById("receipt-instructions-text");
    
    if (selections.specialInstructions && selections.specialInstructions.trim() !== '') {
      instructionsContainer.style.display = 'block';
      instructionsText.textContent = selections.specialInstructions;
    } else {
      instructionsContainer.style.display = 'none';
    }
    
    // Set pickup/delivery info
    document.getElementById("receipt-pickup-time").textContent = 
      new Date(selections.customerDetails.pickupTime).toLocaleString('en-US', options);
    document.getElementById("receipt-location").textContent = 
      selections.deliveryOption === 'delivery' ? 
      selections.customerDetails.address : 
      "Store pickup at main laundry location";
  }

  function formatPaymentMethod(method) {
    switch(method) {
      case 'paystack': return 'Card Payment (Paystack)';
      case 'transfer': return 'Bank Transfer';
      case 'cash': return 'Cash on Delivery';
      default: return method;
    }
  }

function printReceipt() {
  if (confirm('Would you like to download a PDF receipt as well?')) {
    generatePDFReceipt();
  }
  
  // Original print functionality
  const receiptElement = document.getElementById('receiptToPrint');
  const printWindow = window.open('', '', 'width=800,height=600');
  printWindow.document.write('<html><head><title>Laundry Receipt</title>');
  printWindow.document.write('<style>body{font-family:Arial;padding:20px;} .receipt{max-width:500px;margin:0 auto;} .receipt-item{display:flex;justify-content:space-between;margin-bottom:8px;} .receipt-total{font-weight:bold;margin-top:15px;padding-top:15px;border-top:2px dashed #6A0DAD;}</style>');
  printWindow.document.write('</head><body>');
  printWindow.document.write(receiptElement.innerHTML);
  printWindow.document.write('</body></html>');
  printWindow.document.close();
  printWindow.focus();
  setTimeout(() => {
    printWindow.print();
    printWindow.close();
  }, 500);
}

async function generatePDFReceipt() {
  try {
    // Show loading indicator
    const loading = document.createElement('div');
    loading.innerHTML = `
      <div style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:9999;display:flex;justify-content:center;align-items:center;">
        <div style="background:white;padding:20px;border-radius:5px;text-align:center;">
          <div class="loading-spinner" style="margin:0 auto 10px;"></div>
          Generating PDF... Please wait
        </div>
      </div>
    `;
    document.body.appendChild(loading);

    // Get the receipt element
    const receiptElement = document.getElementById('receiptToPrint');
    
    // Create a clone of the element to avoid CSS issues
    const clone = receiptElement.cloneNode(true);
    clone.style.position = 'absolute';
    clone.style.left = '-9999px';
    clone.style.width = '500px'; // Fixed width for consistent rendering
    document.body.appendChild(clone);

    // Use html2canvas with proper configuration
    const canvas = await html2canvas(clone, {
      scale: 2, // Slightly lower scale might work better
      logging: true, // Enable to see errors in console
      useCORS: true, // Important for external images
      allowTaint: true, // If CORS fails
      backgroundColor: '#ffffff'
    });

    // Remove the clone
    document.body.removeChild(clone);

    // Create PDF
    const pdf = new jsPDF({
      orientation: 'portrait',
      unit: 'mm',
      format: 'a5' // Standard size that fits receipts well
    });

    // Calculate dimensions
    const imgWidth = pdf.internal.pageSize.getWidth() - 20; // 10mm margins
    const imgHeight = (canvas.height * imgWidth) / canvas.width;
    
    // Add image to PDF
    pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 10, 10, imgWidth, imgHeight);
    
    // Save the PDF
    pdf.save(`laundry-receipt-${new Date().getTime()}.pdf`);
    
  } catch (error) {
    console.error('PDF generation error:', error);
    alert('Error generating PDF. Please try printing instead.');
  } finally {
    // Remove loading indicator
    const loading = document.querySelector('div > div[style*="position:fixed"]');
    if (loading) loading.parentNode.remove();
  }
}
</script>

</body>
</html>